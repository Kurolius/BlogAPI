<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
</head>
  <body>

    <section class="signup">
    <div class="row" align="center">
      <div  class="col-add col">
          <div class="signup-content">
              <div class="signup-form">
                  <h2 class="form-title">Add User</h2>
                  <form action="/Users" method="POST" class="register-form" id="register-form">
                      <div class="form-group">
                          <label for="name"><i class="zmdi zmdi-account material-icons-name"></i></label>
                          <input type="text" name="username" id="username" placeholder="Your username"/>
                      </div>
                      <div class="form-group">
                          <label for="email"><i class="zmdi zmdi-email"></i></label>
                          <input type="email" name="email" id="email" placeholder="Your Email"/>
                      </div>
                      <div class="form-group">
                          <label for="pass"><i class="zmdi zmdi-lock"></i></label>
                          <input type="password" name="password" id="password" placeholder="Password"/>
                      </div>
                      <div class="form-group">
                          <label for="re-pass"><i class="zmdi zmdi-lock-outline"></i></label>
                          <input type="password" name="re_pass" id="re_pass" placeholder="Repeat your password"/>
                      </div>
                      <div class="form-group">
                        <label for="re-pass"><i class="zmdi zmdi-lock-outline"></i></label>
                        <input type="text" name="role" id="role" placeholder="Role"/>
                    </div>
                      <div class="form-group form-button">
                          <input type="submit" name="signup" id="signup" class="form-submit" value="Register"/>
                      </div>
                  </form>
              </div>
          </div>
      </div>
      <div  class="col-display col">
        <div class="signup-content">
            <div class="signup-form">
                <h2 class="form-title">Users List</h2>
                <table id="table" style="display: none;" class="table table-striped table-hover">
                    <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">username</th>
                        <th scope="col">email</th>
                        <th scope="col">role</th>
                      </tr>
                    </thead>
                    <tbody id="all">
              
                    </tbody>
                  </table>
                  <button onclick="DisplayUsers();  ">Display all</button>
            </div>
        </div>
    </div>
    <div  class="col-request col">
        <div >
            <div >
                <h2 class="form-title">Manage Users</h2>
                    <div class="form-group">
                      <label for="name"><i class="zmdi zmdi-account material-icons-name"></i></label>
                      <input type="text" name="idm" id="idm" placeholder="User Id"/>
        
                   
                      <button onclick="DisplayUser();">Display User</button>
                      <button onclick="deleteUser();"> Delete User </button>

                    </div>
            </div>
            
        </div>
    </div>
    </div>
  </section>
    <script src ="javascripts/jquery.min.js"></script>
    <script >
        const URL = 'http://localhost:3000/users/';
        async function DisplayUsers(){  
          document.getElementById('table').style.display='block';
          getUsers();
        }
        async function DisplayUser(){
          document.getElementById('table').style.display='block';
          getUser();
        }
        async function getUsers() {
          console.log("ok1")
            let response = await fetch(URL);
            let data = await response.text();
            let obj = JSON.parse(data);
            document.getElementById('all').innerHTML =''; 
            obj.map(item=>{
              document.getElementById('all').innerHTML +='<tr><td>'+item.id+'</td><td>'+item.username+'</td><td>'+item.email+'</td><td>'+item.role+'</td></tr>'
            })
          }
    
        async function getUser() {
            console.log("ok1")
            let id = document.querySelector("#idm").value
            if (id){
              let response = await fetch(`${URL}${id}`);
              let data = await response.text();
              let item = JSON.parse(data);
              document.getElementById('all').innerHTML =''; 
              document.getElementById('all').innerHTML='<tr><td>'+item.id+'</td><td>'+item.username+'</td><td>'+item.email+'</td><td>'+item.role+'</td></tr>'
            }else{
              document.getElementById('row').innerHTML='<div class="alert alert-warning mt-3" role="alert">Please specify the ID</div>'
            }
        }
    
        async function deleteUser() {
            var _data = {}
            _data.id = document.getElementById('idm').value 
            console.log(_data.id)
            fetch(URL, {
              method: "DELETE",
              body: JSON.stringify(_data),
              headers: {"Content-type": "application/json; charset=UTF-8"}
            })
            .then(response => response.json()) 
            .then(json => console.log(json))
            .catch(err => console.log(err));
            DisplayUsers();
        }
    
    
      </script>
  </body>
</html>
